<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>IndiaLearn ‚Äì Smart School App (Class 1‚Äì12)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Simple Google Font for nicer look -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: "Poppins", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      min-height: 100vh;
      background: radial-gradient(circle at top left, #ffecd2, #fcb69f);
      display: flex;
      align-items: stretch;
      justify-content: center;
      padding: 16px;
    }

    #app {
      background: #ffffffee;
      border-radius: 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.12);
      max-width: 1100px;
      width: 100%;
      padding: 16px 16px 24px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      padding: 8px 10px 4px;
      border-bottom: 1px dashed rgba(0,0,0,0.08);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .logo-badge {
      width: 38px;
      height: 38px;
      border-radius: 50%;
      background: linear-gradient(135deg, #ffb347, #ffcc33);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 20px;
      color: #ffffff;
      box-shadow: 0 4px 12px rgba(0,0,0,0.18);
    }

    .logo-text-main {
      font-size: 20px;
      font-weight: 700;
      color: #ff7043;
    }

    .logo-text-sub {
      font-size: 11px;
      color: #777;
      line-height: 1.2;
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      font-size: 10px;
      justify-content: flex-end;
    }

    .chip {
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,0.06);
      background: #fff7e6;
      color: #ff7043;
      font-weight: 500;
    }

    main {
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2.6fr);
      gap: 12px;
    }

    @media (max-width: 860px) {
      main {
        grid-template-columns: 1fr;
      }
    }

    .card {
      background: #ffffff;
      border-radius: 16px;
      padding: 10px 12px;
      box-shadow: 0 3px 12px rgba(0,0,0,0.06);
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .card-title {
      font-size: 14px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .card-title span.emoji {
      font-size: 18px;
    }

    .card-subtitle {
      font-size: 11px;
      color: #777;
    }

    .pill {
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 10px;
      background: #e3f2fd;
      color: #1976d2;
      font-weight: 600;
    }

    .section-body {
      font-size: 12px;
      color: #555;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .welcome-banner {
      border-radius: 12px;
      padding: 10px;
      background: linear-gradient(135deg, #ff9a9e, #fecfef);
      color: #4a148c;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .welcome-title {
      font-size: 16px;
      font-weight: 700;
    }

    .welcome-sub {
      font-size: 11px;
    }

    .badge-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
      font-size: 10px;
    }

    .badge {
      padding: 2px 7px;
      border-radius: 999px;
      background: #ffffffcc;
      color: #4a148c;
      font-weight: 600;
    }

    .grid {
      display: grid;
      gap: 6px;
    }

    .grid-classes {
      grid-template-columns: repeat(6, minmax(0, 1fr));
    }

    .grid-subjects {
      grid-template-columns: repeat(4, minmax(0, 1fr));
    }

    @media (max-width: 600px) {
      .grid-classes {
        grid-template-columns: repeat(4, minmax(0, 1fr));
      }
      .grid-subjects {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    .btn {
      border: none;
      outline: none;
      cursor: pointer;
      padding: 6px 8px;
      border-radius: 999px;
      background: #f5f5f5;
      font-size: 12px;
      font-weight: 600;
      color: #555;
      box-shadow: 0 1px 3px rgba(0,0,0,0.12);
      transition: transform 0.08s ease, box-shadow 0.1s ease, background 0.1s ease;
      text-align: center;
    }

    .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 3px 6px rgba(0,0,0,0.15);
      background: #fffaf0;
    }

    .btn.selected {
      background: linear-gradient(135deg, #ff9800, #ffb74d);
      color: #fff;
      box-shadow: 0 3px 8px rgba(255,152,0,0.4);
    }

    .btn-primary {
      background: linear-gradient(135deg, #42a5f5, #5c6bc0);
      color: #fff;
      border-radius: 999px;
      font-size: 12px;
      padding: 6px 14px;
    }

    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }

    .hint {
      font-size: 11px;
      color: #888;
    }

    .inline-info {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      font-size: 11px;
      align-items: center;
      color: #666;
    }

    .dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #ff9800;
    }

    .syllabus-list,
    .quiz-question,
    .quiz-options,
    .ai-output {
      font-size: 12px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .syllabus-tag-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 2px;
    }

    .syllabus-tag {
      font-size: 10px;
      padding: 2px 7px;
      border-radius: 999px;
      background: #e8f5e9;
      color: #2e7d32;
    }

    .skill-chip {
      font-size: 10px;
      padding: 2px 7px;
      border-radius: 999px;
      background: #e3f2fd;
      color: #1565c0;
    }

    textarea {
      width: 100%;
      min-height: 70px;
      border-radius: 10px;
      border: 1px solid #eee;
      padding: 6px 8px;
      font-size: 12px;
      resize: vertical;
      outline: none;
    }

    textarea:focus {
      border-color: #42a5f5;
      box-shadow: 0 0 0 2px rgba(66,165,245,0.15);
    }

    .progress-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      font-size: 11px;
    }

    .progress-pill {
      padding: 3px 8px;
      border-radius: 999px;
      background: #f1f8e9;
      color: #558b2f;
      font-weight: 600;
    }

    .ai-output-box {
      border-radius: 10px;
      border: 1px dashed #e0e0e0;
      padding: 6px 8px;
      background: #fafafa;
      max-height: 180px;
      overflow-y: auto;
    }

    .small-label {
      font-size: 10px;
      color: #999;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .pill-soft {
      padding: 2px 8px;
      border-radius: 999px;
      background: #fff3e0;
      color: #ef6c00;
      font-size: 10px;
      font-weight: 600;
    }

    .row-between {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
    }

    .divider {
      height: 1px;
      background: linear-gradient(to right, transparent, rgba(0,0,0,0.06), transparent);
      margin: 4px 0 2px;
    }

    .quiz-options label {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 4px 6px;
      border-radius: 999px;
      background: #f9fbe7;
      cursor: pointer;
      border: 1px solid transparent;
      transition: border 0.08s ease, background 0.08s ease;
    }

    .quiz-options input[type="radio"] {
      accent-color: #ff9800;
      cursor: pointer;
    }

    .quiz-options label:hover {
      border-color: #ffb74d;
      background: #fffde7;
    }

    .status-text {
      font-size: 11px;
      color: #888;
    }

    footer {
      margin-top: 6px;
      font-size: 10px;
      color: #999;
      text-align: right;
    }

    /* DEBUG OVERLAY */

    #debugToggle {
      position: fixed;
      right: 8px;
      bottom: 8px;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #212121ee;
      color: #ffeb3b;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.35);
      z-index: 9999;
      user-select: none;
    }

    #debugPanel {
      position: fixed;
      right: 8px;
      bottom: 48px;
      width: min(380px, 90vw);
      height: 40vh;
      background: #1e1e1ef0;
      color: #e0e0e0;
      border-radius: 12px 12px 0 12px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.5);
      display: none;
      flex-direction: column;
      z-index: 9998;
      backdrop-filter: blur(4px);
    }

    #debugPanelHeader {
      padding: 4px 8px;
      border-bottom: 1px solid rgba(255,255,255,0.12);
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
    }

    #debugPanelHeader span {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    #debugPanelHeader button {
      background: transparent;
      border: none;
      color: #f5f5f5;
      font-size: 14px;
      cursor: pointer;
    }

    #debugLog {
      flex: 1;
      padding: 4px 8px;
      font-family: "Fira Code", "Consolas", monospace;
      font-size: 10px;
      overflow-y: auto;
      white-space: pre-wrap;
    }

    #debugPanelFooter {
      padding: 2px 8px 4px;
      border-top: 1px solid rgba(255,255,255,0.12);
      font-size: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    #debugStatusDot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #66bb6a;
      box-shadow: 0 0 8px #66bb6a;
    }

    .debug-tag {
      padding: 1px 6px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.3);
      font-size: 9px;
      opacity: 0.8;
    }
  </style>
</head>
<body>
  <div id="app">
    <header>
      <div class="logo">
        <div class="logo-badge">IL</div>
        <div>
          <div class="logo-text-main">IndiaLearn</div>
          <div class="logo-text-sub">
            Class 1‚Äì12 ‚Ä¢ CBSE / State ‚Ä¢ Future-Ready Skills
          </div>
        </div>
      </div>
      <div>
        <div class="chip-row">
          <div class="chip">üß† AI Tutor</div>
          <div class="chip">üì± Mobile First</div>
          <div class="chip">üáÆüá≥ Made for Indian Students</div>
        </div>
      </div>
    </header>

    <main>
      <!-- LEFT SIDE: Welcome, Class & Subject, Quiz -->
      <section class="card" id="welcomeSection">
        <div class="card-header">
          <div>
            <div class="card-title">
              <span class="emoji">üéì</span>
              <span>Welcome, Super Student!</span>
            </div>
            <div class="card-subtitle">Choose your class & subject to start learning.</div>
          </div>
          <div class="pill">Step 1 ‚Üí 2 ‚Üí 3</div>
        </div>
        <div class="section-body">
          <div class="welcome-banner">
            <div class="welcome-title">One App for School + Future Skills üöÄ</div>
            <div class="welcome-sub">
              Learn Maths, Science, English & Hindi along with
              <strong>AI, coding, money skills, climate, mental health & safety</strong>.
            </div>
            <div class="badge-row">
              <div class="badge">üìö Class 1‚Äì12 Syllabus</div>
              <div class="badge">üßÆ Math Quiz</div>
              <div class="badge">ü§ñ AI Study Partner</div>
            </div>
          </div>

          <!-- Class Selection -->
          <div>
            <div class="row-between">
              <div class="card-title" style="font-size:13px;">
                <span class="emoji">üè´</span>
                <span>Select Your Class</span>
              </div>
              <div class="hint">Tap one: 1‚Äì12</div>
            </div>
            <div id="classButtons" class="grid grid-classes" aria-label="Class selection buttons">
              <!-- Filled by JS -->
            </div>
          </div>

          <!-- Subject Selection -->
          <div>
            <div class="row-between">
              <div class="card-title" style="font-size:13px;">
                <span class="emoji">üìò</span>
                <span>Select Subject</span>
              </div>
              <div class="hint">Core subjects (+ future skills)</div>
            </div>
            <div id="subjectButtons" class="grid grid-subjects" aria-label="Subject selection buttons">
              <!-- Filled by JS -->
            </div>
          </div>

          <div class="inline-info">
            <div class="dot"></div>
            <span id="currentSelectionLabel">No class/subject selected.</span>
          </div>

          <div class="divider"></div>

          <!-- Quiz Area -->
          <div id="quizSection">
            <div class="card-header" style="padding:0; margin-bottom:2px;">
              <div class="card-title" style="font-size:13px;">
                <span class="emoji">üßÆ</span>
                <span>Quick Math Quiz ‚Äì Class 1 (Sample)</span>
              </div>
              <div class="pill-soft">10 tiny questions</div>
            </div>

            <div class="section-body">
              <div class="hint">
                Works best when <strong>Class 1 + Maths</strong> is selected. For other classes,
                this acts as a demo quiz.
              </div>
              <div id="quizContent">
                <button class="btn-primary" id="startQuizBtn">‚ñ∂ Start Sample Quiz</button>
              </div>
              <div class="status-text" id="quizStatus"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- RIGHT SIDE: Syllabus, AI Tutor, Progress -->
      <section class="card">
        <!-- Syllabus -->
        <div id="syllabusSection">
          <div class="card-header">
            <div>
              <div class="card-title">
                <span class="emoji">üìö</span>
                <span>Smart Syllabus + Future-Proof Skills</span>
              </div>
              <div class="card-subtitle">
                Based on your class & subject, plus essential <strong>life skills</strong>.
              </div>
            </div>
            <div class="pill">Auto-generated</div>
          </div>
          <div class="section-body">
            <div class="small-label">SYLLABUS SNAPSHOT</div>
            <div id="syllabusContent" class="syllabus-list">
              Select a class & subject to see your smart syllabus here.
            </div>
          </div>
        </div>

        <div class="divider"></div>

        <!-- AI Tutor -->
        <div id="aiSection">
          <div class="card-header">
            <div>
              <div class="card-title">
                <span class="emoji">ü§ñ</span>
                <span>AI Study Partner (Hugging Face)</span>
              </div>
              <div class="card-subtitle">
                Ask doubts, get explanations or new practice questions.
              </div>
            </div>
            <div class="pill-soft">Online ‚Ä¢ Text</div>
          </div>
          <div class="section-body">
            <label for="aiQuestion" class="small-label">YOUR QUESTION / TOPIC</label>
            <textarea id="aiQuestion" placeholder="Example: 'Explain place value for Class 3' or 'Give 5 word problems on addition for Class 1'"></textarea>

            <div class="row-between">
              <div class="hint">
                AI is tuned for <strong>Indian school style</strong> answers ‚Äì short, simple, and exam-friendly.
              </div>
              <button class="btn-primary" id="askAiBtn">‚ö° Ask AI</button>
            </div>

            <div class="ai-output">
              <div class="small-label">AI RESPONSE</div>
              <div id="aiStatus" class="status-text">AI not used yet.</div>
              <div class="ai-output-box" id="aiAnswerBox">
                Your AI explanation will appear here.
              </div>
            </div>
          </div>
        </div>

        <div class="divider"></div>

        <!-- Progress -->
        <div id="progressSection">
          <div class="card-header">
            <div class="card-title">
              <span class="emoji">üìà</span>
              <span>Your Learning Progress (This Session)</span>
            </div>
            <div class="pill">Local only</div>
          </div>
          <div class="section-body">
            <div class="progress-row" id="progressRow">
              <div class="progress-pill" id="progressQuizzes">üßÆ Quizzes taken: 0</div>
              <div class="progress-pill" id="progressCorrect">‚úÖ Correct answers: 0</div>
              <div class="progress-pill" id="progressAi">ü§ñ AI questions: 0</div>
            </div>
            <div class="hint">
              This data is stored <strong>only in this browser tab</strong>. Closing the tab will reset it.
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer>
      v1.0 ‚Ä¢ Frontend-only demo ‚Ä¢ Hugging Face Space integration with visual debug console.
    </footer>
  </div>

  <!-- DEBUG OVERLAY -->
  <div id="debugToggle" title="Toggle debug console">üêû</div>
  <div id="debugPanel">
    <div id="debugPanelHeader">
      <span>
        <strong>Visual Debugger</strong>
        <span style="opacity:0.8;">‚Ä¢ UI & API logs</span>
      </span>
      <button id="debugCloseBtn" title="Close debug panel">‚úï</button>
    </div>
    <pre id="debugLog"></pre>
    <div id="debugPanelFooter">
      <div style="display:flex; align-items:center; gap:6px;">
        <div id="debugStatusDot"></div>
        <span style="opacity:0.8;">LIVE</span>
      </div>
      <div class="debug-tag">UI ‚Ä¢ Buttons ‚Ä¢ HF API</div>
    </div>
  </div>

  <script>
    /************************************************************
     *  HUGGING FACE FRONTEND CONFIG (SAMPLE DEMO SPACE)
     ************************************************************/
    // ‚ùó You can replace this later with your own Space or backend.
    // Example format (Gradio Space): POST to /api/predict with body { data: [prompt] }
    const HF_BACKEND_URL = "https://yuntian-deng-llama-2-7b-chat.hf.space/api/predict";

    /************************************************************
     *  GLOBAL STATE
     ************************************************************/
    const state = {
      selectedClass: null,
      selectedSubject: null,
      quizIndex: 0,
      quizQuestions: [],
      quizScore: 0,
      progress: {
        quizzesTaken: 0,
        correctAnswers: 0,
        aiQueries: 0,
      }
    };

    /************************************************************
     *  VISUAL DEBUGGER
     ************************************************************/
    const debugLogEl = document.getElementById("debugLog");
    let debugPanelVisible = false;
    const debugPanel = document.getElementById("debugPanel");
    const debugToggle = document.getElementById("debugToggle");
    const debugCloseBtn = document.getElementById("debugCloseBtn");

    function debugLog(message, extra) {
      const timestamp = new Date().toISOString().split("T")[1].replace("Z", "");
      let line = "[" + timestamp + "] " + message;
      if (extra !== undefined) {
        try {
          line += " ‚Üí " + JSON.stringify(extra);
        } catch (e) {
          line += " ‚Üí [unserializable extra]";
        }
      }
      if (debugLogEl) {
        debugLogEl.textContent += line + "\n";
        debugLogEl.scrollTop = debugLogEl.scrollHeight;
      }
      // Also log to console for dev tools
      console.log("[DEBUG]", message, extra || "");
    }

    function toggleDebugPanel(forceState) {
      debugPanelVisible = typeof forceState === "boolean" ? forceState : !debugPanelVisible;
      if (debugPanelVisible) {
        debugPanel.style.display = "flex";
        debugLog("Debug panel opened");
      } else {
        debugPanel.style.display = "none";
        debugLog("Debug panel closed");
      }
    }

    debugToggle.addEventListener("click", () => toggleDebugPanel());
    debugCloseBtn.addEventListener("click", () => toggleDebugPanel(false));

    window.addEventListener("error", (event) => {
      debugLog("Window error captured", {
        message: event.message,
        filename: event.filename,
        lineno: event.lineno,
        colno: event.colno
      });
    });

    /************************************************************
     *  APP INIT ‚Äì CLASS & SUBJECT BUTTONS
     ************************************************************/
    const classes = Array.from({ length: 12 }, (_, i) => i + 1);

    const subjects = [
      { id: "maths", label: "Maths", emoji: "üßÆ" },
      { id: "science", label: "Science", emoji: "üî¨" },
      { id: "english", label: "English", emoji: "üìñ" },
      { id: "hindi", label: "Hindi", emoji: "üìù" }
    ];

    function buildClassButtons() {
      const container = document.getElementById("classButtons");
      if (!container) {
        debugLog("Class buttons container NOT found", { id: "classButtons" });
        return;
      }
      container.innerHTML = "";
      classes.forEach((cls) => {
        const btn = document.createElement("button");
        btn.className = "btn";
        btn.textContent = "Class " + cls;
        btn.dataset.value = cls;
        btn.addEventListener("click", () => handleClassClick(cls, btn));
        container.appendChild(btn);
      });
      debugLog("Class buttons built", { count: classes.length });
    }

    function buildSubjectButtons() {
      const container = document.getElementById("subjectButtons");
      if (!container) {
        debugLog("Subject buttons container NOT found", { id: "subjectButtons" });
        return;
      }
      container.innerHTML = "";
      subjects.forEach((sub) => {
        const btn = document.createElement("button");
        btn.className = "btn";
        btn.textContent = sub.emoji + " " + sub.label;
        btn.dataset.value = sub.id;
        btn.addEventListener("click", () => handleSubjectClick(sub.id, btn));
        container.appendChild(btn);
      });
      debugLog("Subject buttons built", { count: subjects.length });
    }

    function handleClassClick(cls, clickedBtn) {
      state.selectedClass = cls;
      debugLog("Class selected", { class: cls });

      // Visual selection
      document.querySelectorAll("#classButtons .btn").forEach((btn) => {
        btn.classList.toggle("selected", btn === clickedBtn);
      });

      updateSelectionLabel();
      buildClassSyllabus();
    }

    function handleSubjectClick(subjectId, clickedBtn) {
      state.selectedSubject = subjectId;
      debugLog("Subject selected", { subject: subjectId });

      document.querySelectorAll("#subjectButtons .btn").forEach((btn) => {
        btn.classList.toggle("selected", btn === clickedBtn);
      });

      updateSelectionLabel();
      buildClassSyllabus();
    }

    function updateSelectionLabel() {
      const el = document.getElementById("currentSelectionLabel");
      if (!el) return;

      if (!state.selectedClass && !state.selectedSubject) {
        el.textContent = "No class/subject selected.";
        return;
      }

      const subjectObj = subjects.find((s) => s.id === state.selectedSubject);
      const subjectLabel = subjectObj ? subjectObj.label : "No subject";
      const classLabel = state.selectedClass ? "Class " + state.selectedClass : "No class";
      el.textContent = classLabel + " ‚Ä¢ " + subjectLabel;
    }

    /************************************************************
     *  FUTURE-PROOF SYLLABUS BUILDER
     ************************************************************/
    function buildClassSyllabus() {
      const container = document.getElementById("syllabusContent");
      if (!container) return;

      const cls = state.selectedClass;
      const subjectId = state.selectedSubject;
      if (!cls || !subjectId) {
        container.innerHTML = "Please select a <strong>class</strong> and a <strong>subject</strong> to view syllabus.";
        debugLog("Syllabus not built ‚Äì missing selection", { class: cls, subject: subjectId });
        return;
      }

      // Base topics per subject (simple demo; can be replaced by real syllabus)
      const baseTopicsBySubject = {
        maths: [
          "Numbers and counting (0‚Äì100, later bigger numbers)",
          "Basic operations: addition, subtraction, multiplication, division",
          "Word problems from real life (money, time, distance)",
          "Geometry basics: shapes, patterns, measurement"
        ],
        science: [
          "Living and non-living things",
          "Plants, animals & human body basics",
          "Matter, water, air, and weather",
          "Simple experiments and observation"
        ],
        english: [
          "Reading short stories and passages",
          "Grammar: nouns, verbs, adjectives, tenses (as per class level)",
          "Vocabulary building with everyday words",
          "Writing: sentences, paragraphs, letters"
        ],
        hindi: [
          "Varnamala and basic pronunciation",
          "Reading short passages and poems",
          "Grammar: sangya, kriya, visheshan (as per class level)",
          "Writing: anuchhed, patra, rachnatmak lekhan"
        ]
      };

      const subjectName = subjects.find((s) => s.id === subjectId)?.label || "Subject";
      const baseTopics = baseTopicsBySubject[subjectId] || ["Core textbook topics as per board syllabus."];

      // Future-proof universal skills (always shown)
      const futureSkillsUniversal = [
        { tag: "üåç Climate & Sustainability", description: "Understanding pollution, water saving, recycling, clean energy and how daily actions affect Earth." },
        { tag: "üß† Mental Health & Well-being", description: "Recognising feelings, stress basics, kindness, gratitude, simple breathing and calm-down techniques." },
        { tag: "üîê Digital Safety & Cyber Hygiene", description: "Safe passwords, not sharing OTP, avoiding strangers online, basic cyberbullying awareness." },
        { tag: "üß† Critical Thinking & Problem Solving", description: "Asking 'why', comparing information, spotting patterns, solving puzzles and real-life problems." },
        { tag: "üí∞ Financial Literacy & Money Basics", description: "Saving vs spending, needs vs wants, simple budgeting and importance of not taking random loans." }
      ];

      // Age-appropriate coding / AI skills (light for lower classes)
      const codingAndAiSkills = [];
      if (cls <= 5) {
        codingAndAiSkills.push(
          { tag: "üêç Coding Foundations (Blocks / Logic)", description: "Understanding sequences, patterns and logic through games and visual coding." },
          { tag: "ü§ñ AI Awareness (Very Basic)", description: "Knowing that some apps are 'smart', ask questions, and must be used respectfully." }
        );
      } else if (cls <= 8) {
        codingAndAiSkills.push(
          { tag: "üêç Python Basics", description: "Print, variables, basic maths, if-else, loops with small, fun programs." },
          { tag: "üåê JavaScript & Web", description: "Understanding how web pages work; writing simple scripts for interaction." },
          { tag: "üìä Data Literacy", description: "Reading simple charts and tables; understanding averages and trends." },
          { tag: "ü§ñ AI & Chatbots", description: "Using AI responsibly for homework help; understanding bias and limitations." }
        );
      } else {
        codingAndAiSkills.push(
          { tag: "üêç Python (Intermediate)", description: "Functions, lists, dictionaries, simple projects like calculators or quiz apps." },
          { tag: "üåê JavaScript & Frontend", description: "DOM basics, events, simple interactive web pages." },
          { tag: "üìä Data Analysis & AI Literacy", description: "Collecting data, using spreadsheets, basic charts, intro to ML ideas." },
          { tag: "üí∏ Entrepreneurship & Side Projects", description: "Project planning, digital products, ethical earning using skills + AI." }
        );
      }

      // Render syllabus
      let html = "";
      html += `<div><strong>${"Class " + cls} ‚Ä¢ ${subjectName}</strong></div>`;
      html += `<div class="syllabus-tag-row">`;
      html += `<div class="syllabus-tag">üìñ Textbook + NCERT/Board aligned</div>`;
      html += `<div class="syllabus-tag">üß© Concept + Application</div>`;
      html += `<div class="syllabus-tag">üáÆüá≥ India context examples</div>`;
      html += `</div>`;

      html += `<ul style="margin-top:6px; padding-left:18px;">`;
      baseTopics.forEach((topic) => {
        html += `<li>${topic}</li>`;
      });
      html += `</ul>`;

      html += `<div style="margin-top:6px; font-size:11px; color:#666;"><strong>Future-Proof Life Skills</strong> (taught through stories, discussions and activities):</div>`;
      html += `<ul style="margin-top:4px; padding-left:18px;">`;
      futureSkillsUniversal.forEach((skill) => {
        html += `<li><strong>${skill.tag}:</strong> ${skill.description}</li>`;
      });
      html += `</ul>`;

      html += `<div style="margin-top:6px; font-size:11px; color:#666;"><strong>Coding, AI & Data Skills</strong> (age-appropriate, gradual):</div>`;
      html += `<ul style="margin-top:4px; padding-left:18px;">`;
      codingAndAiSkills.forEach((skill) => {
        html += `<li><strong>${skill.tag}:</strong> ${skill.description}</li>`;
      });
      html += `</ul>`;

      html += `<div class="syllabus-tag-row" style="margin-top:4px;">`;
      html += `<div class="skill-chip">üß† Critical thinking in every subject</div>`;
      html += `<div class="skill-chip">üë• Group work & projects</div>`;
      html += `<div class="skill-chip">üó£Ô∏è Speaking & presentation practice</div>`;
      html += `</div>`;

      container.innerHTML = html;
      debugLog("Syllabus built", { class: cls, subject: subjectId });
    }

    /************************************************************
     *  SAMPLE MATH QUIZ ‚Äì CLASS 1
     ************************************************************/
    const sampleQuizQuestions = [
      { q: "What is 2 + 3?", options: [4, 5, 6], answer: 5 },
      { q: "What is 1 + 7?", options: [7, 8, 9], answer: 8 },
      { q: "What is 4 + 4?", options: [6, 8, 9], answer: 8 },
      { q: "What is 5 + 1?", options: [5, 6, 7], answer: 6 },
      { q: "What is 3 + 2?", options: [4, 5, 6], answer: 5 },
      { q: "What is 0 + 9?", options: [8, 9, 10], answer: 9 },
      { q: "What is 6 + 3?", options: [8, 9, 10], answer: 9 },
      { q: "What is 2 + 2?", options: [3, 4, 5], answer: 4 },
      { q: "What is 7 + 1?", options: [7, 8, 9], answer: 8 },
      { q: "What is 9 + 0?", options: [8, 9, 10], answer: 9 }
    ];

    function startQuiz() {
      state.quizQuestions = sampleQuizQuestions;
      state.quizIndex = 0;
      state.quizScore = 0;
      debugLog("Quiz started", { totalQuestions: state.quizQuestions.length });

      renderQuizQuestion();
    }

    function renderQuizQuestion() {
      const quizContent = document.getElementById("quizContent");
      const quizStatus = document.getElementById("quizStatus");
      if (!quizContent || !quizStatus) return;

      if (state.quizIndex >= state.quizQuestions.length) {
        // End of quiz
        state.progress.quizzesTaken += 1;
        state.progress.correctAnswers += state.quizScore;
        updateProgressUI();

        quizContent.innerHTML = `
          <div class="quiz-question">
            <strong>Great job!</strong> You answered ${state.quizScore} out of ${state.quizQuestions.length} correctly.
            <button class="btn-primary" style="margin-top:6px;" id="restartQuizBtn">üîÅ Try Again</button>
          </div>
        `;
        quizStatus.textContent = "Quiz finished. You can try again to improve your score.";
        document.getElementById("restartQuizBtn").addEventListener("click", startQuiz);
        debugLog("Quiz completed", {
          score: state.quizScore,
          total: state.quizQuestions.length
        });
        return;
      }

      const current = state.quizQuestions[state.quizIndex];
      quizStatus.textContent = `Question ${state.quizIndex + 1} of ${state.quizQuestions.length}`;

      let html = "";
      html += `<div class="quiz-question"><strong>${current.q}</strong></div>`;
      html += `<div class="quiz-options">`;
      current.options.forEach((opt, idx) => {
        const inputId = `q${state.quizIndex}_opt${idx}`;
        html += `
          <label for="${inputId}">
            <input type="radio" name="quizOption" id="${inputId}" value="${opt}" />
            ${opt}
          </label>
        `;
      });
      html += `</div>`;
      html += `<button class="btn-primary" style="margin-top:6px;" id="nextQuestionBtn">Next</button>`;

      quizContent.innerHTML = html;

      document.getElementById("nextQuestionBtn").addEventListener("click", () => {
        const selected = document.querySelector('input[name="quizOption"]:checked');
        if (!selected) {
          alert("Please choose an answer before going to next question.");
          return;
        }
        const selectedValue = Number(selected.value);
        const correct = state.quizQuestions[state.quizIndex].answer;
        if (selectedValue === correct) {
          state.quizScore += 1;
          debugLog("Quiz question answered correctly", {
            index: state.quizIndex,
            answer: selectedValue
          });
        } else {
          debugLog("Quiz question answered incorrectly", {
            index: state.quizIndex,
            chosen: selectedValue,
            correct
          });
        }

        state.quizIndex += 1;
        renderQuizQuestion();
      });
    }

    /************************************************************
     *  HUGGING FACE AI TUTOR ‚Äì FRONTEND CALL
     ************************************************************/
    async function askAi() {
      const questionEl = document.getElementById("aiQuestion");
      const statusEl = document.getElementById("aiStatus");
      const answerBox = document.getElementById("aiAnswerBox");
      const btn = document.getElementById("askAiBtn");

      if (!questionEl || !statusEl || !answerBox || !btn) {
        debugLog("AI UI elements missing");
        return;
      }

      const userQuestion = questionEl.value.trim();
      if (!userQuestion) {
        alert("Please type a question or topic for the AI to help with.");
        return;
      }

      const subjectObj = subjects.find((s) => s.id === state.selectedSubject);
      const contextClass = state.selectedClass ? "Class " + state.selectedClass : "Class unknown";
      const contextSubject = subjectObj ? subjectObj.label : "Subject unknown";

      // We wrap the question with a prompt for school-style answers
      const fullPrompt =
        `You are a helpful tutor for Indian school students.\n` +
        `Board: CBSE/State. ${contextClass}, ${contextSubject}.\n` +
        `Explain step by step in simple English (and use small examples). ` +
        `Avoid very advanced topics unless necessary.\n\n` +
        `Student question: ${userQuestion}`;

      statusEl.textContent = "Contacting AI via Hugging Face Space...";
      btn.disabled = true;
      btn.textContent = "‚è≥ Asking AI...";

      debugLog("AI request starting", {
        backend: HF_BACKEND_URL,
        class: state.selectedClass,
        subject: state.selectedSubject
      });

      try {
        const response = await fetch(HF_BACKEND_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          // Typical Gradio Space: { data: [prompt] }
          body: JSON.stringify({ data: [fullPrompt] })
        });

        if (!response.ok) {
          throw new Error("HF API status " + response.status);
        }

        const result = await response.json();

        // Many Gradio Spaces return { data: [ "text..." ] } or [ { generated_text: "..."} ]
        let aiText = "";
        if (Array.isArray(result.data)) {
          // Common format: data[0] is the text
          aiText = String(result.data[0]);
        } else if (Array.isArray(result) && result[0].generated_text) {
          aiText = result[0].generated_text;
        } else if (result.generated_text) {
          aiText = result.generated_text;
        } else {
          aiText = "AI responded, but the format was unexpected. Please adjust JSON parsing in code.";
        }

        statusEl.textContent = "AI answer received.";
        answerBox.textContent = aiText;
        state.progress.aiQueries += 1;
        updateProgressUI();

        debugLog("AI response received", {
          length: aiText.length
        });
      } catch (error) {
        console.error(error);
        statusEl.textContent =
          "There was an error connecting to the Hugging Face Space. Check HF_BACKEND_URL or network connection.";
        answerBox.textContent = error.message;
        debugLog("AI request error", { error: String(error) });
      } finally {
        btn.disabled = false;
        btn.textContent = "‚ö° Ask AI";
      }
    }

    /************************************************************
     *  PROGRESS UI
     ************************************************************/
    function updateProgressUI() {
      document.getElementById("progressQuizzes").textContent =
        "üßÆ Quizzes taken: " + state.progress.quizzesTaken;
      document.getElementById("progressCorrect").textContent =
        "‚úÖ Correct answers: " + state.progress.correctAnswers;
      document.getElementById("progressAi").textContent =
        "ü§ñ AI questions: " + state.progress.aiQueries;
    }

    /************************************************************
     *  DOM READY ‚Äì INITIALISE EVERYTHING
     ************************************************************/
    document.addEventListener("DOMContentLoaded", () => {
      debugLog("DOM fully loaded, initialising app...");

      try {
        buildClassButtons();
        buildSubjectButtons();

        const startQuizBtn = document.getElementById("startQuizBtn");
        if (startQuizBtn) {
          startQuizBtn.addEventListener("click", startQuiz);
        } else {
          debugLog("startQuizBtn not found");
        }

        const askAiBtn = document.getElementById("askAiBtn");
        if (askAiBtn) {
          askAiBtn.addEventListener("click", askAi);
        } else {
          debugLog("askAiBtn not found");
        }

        updateProgressUI();
        debugLog("App initialised successfully");
      } catch (err) {
        debugLog("App initialisation error", { error: String(err) });
      }
    });
  </script>
</body>
</html>
